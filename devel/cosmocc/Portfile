# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

name                cosmocc
revision            0
license             ISC
maintainers         openmaintainer
categories          devel
platforms           darwin linux freebsd netbsd openbsd
supported_archs     arm64 x86_64
description         build-once run-anywhere c library
long_description    "Cosmopolitan Libc makes C a build-once run-anywhere language, like Java, \
                    except it doesn't need an interpreter or virtual machine. Instead, it \
                    reconfigures stock GCC and Clang to output a POSIX-approved polyglot format \
                    that runs natively on Linux + Mac + Windows + FreeBSD + OpenBSD 7.3 + NetBSD \
                    + BIOS with the best possible performance and the tiniest footprint imaginable."

github.setup        jart cosmopolitan 4.0.2
github.tarball_from releases
distname            cosmopolitan-${github.version}

checksums           rmd160  d38bb6047a972e472d1359cbfdb9c78aad3e6880 \
                    sha256  e466106b18064e0c996ef64d261133af867bccd921ad14e54975d89aa17a8717 \
                    size    44058183
patchfiles          package.sh.diff download-cosmocc.sh.diff

use_configure       no
depends_build       port:gmake
build.cmd           tool/cosmocc/package.sh
build.target

destroot {
    file copy ${worksrcpath}/cosmocc ${destroot}${prefix}/cosmocc
    file copy ${filespath}/launcher ${destroot}${prefix}/bin/cosmocc
    foreach f [glob -directory ${worksrcpath}/cosmocc *cosmo*] {
        if {$f != cosmocc} {
            file link --symbolic ${destroot}${prefix}/bin/${f} cosmocc
        }
    }
}
